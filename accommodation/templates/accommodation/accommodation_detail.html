{% extends "base.html" %}
{% block title %}{{ accommodation.title }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-lg border-0">
    {% if accommodation.image %}
      <img src="{{ accommodation.image.url }}" alt="{{ accommodation.title }}" class="card-img-top" style="max-height: 400px; object-fit: cover; border-radius: 10px 10px 0 0;">
    {% else %}
      <img src="https://via.placeholder.com/800x400?text=No+Image" alt="No image" class="card-img-top" style="border-radius: 10px 10px 0 0;">
    {% endif %}

    <div class="card-body p-4">
      <h2 class="fw-bold text-primary mb-3">{{ accommodation.title }}</h2>

      {% if accommodation.description %}
        <p class="text-muted">{{ accommodation.description }}</p>
      {% endif %}

      <div class="mt-3">
        <p><strong>üìç Address:</strong> {{ accommodation.address }}, {{ accommodation.city }}</p>
        <hr>

        <h5 class="fw-semibold text-secondary mb-3">Pricing Details</h5>
        <p><strong>üí≥ Original price:</strong> ‚Ç¨{{ original_price|floatformat:2 }}</p>
        <p><strong>‚úÖ Final price:</strong> 
          <span class="fw-bold" style="color:green;">‚Ç¨{{ final_price|floatformat:2 }}</span>
        </p>

        {% if festival_name %}
          <p class="mt-2 p-2 bg-light border rounded text-success fw-semibold">
            üéâ <strong>{{ festival_name }}</strong> - {{ discount_percent }}% OFF Applied!
          </p>
        {% else %}
          <p class="mt-2 text-muted">No active festival discounts at the moment.</p>
        {% endif %}
      </div>

      <hr>

      <h4 class="fw-semibold mt-4 mb-3 text-secondary">Available Rooms</h4>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-primary">
            <tr>
              <th>Room Number</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for room in accommodation.room_set.all %}
              <tr>
                <td>Room {{ room.room_number }}</td>
                <td>
                  {% if room.status == "Available" %}
                    <span class="badge bg-success px-3 py-2">Available</span>
                  {% else %}
                    <span class="badge bg-danger px-3 py-2">Booked</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="2" class="text-center text-muted">No rooms available.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between mt-4 flex-wrap gap-2">
        {% if user.is_staff %}
          <a href="{% url 'accommodation:upload_image' accommodation.id %}" class="btn btn-outline-primary fw-semibold">
            ‚úèÔ∏è Update Image
          </a>
        {% endif %}

        <a href="{% url 'accommodation:accommodation_list' %}" class="btn btn-outline-secondary fw-semibold">
          ‚Üê Back to Listings
        </a>

        {% if has_available_rooms %}
          <a href="{% url 'accommodation:book_room' accommodation.id %}" class="btn btn-primary fw-semibold">
            Book a Room
          </a>
        {% else %}
          <button class="btn btn-secondary fw-semibold" disabled>No Rooms Available</button>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
